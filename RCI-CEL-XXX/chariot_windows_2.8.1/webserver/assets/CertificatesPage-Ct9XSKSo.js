import{_ as Q,d as L,M as u,N as r,O as t,aK as $,aq as b,f as a,ar as _,Q as h,U as s,S as y,V as l,au as C,P as n,aF as v,F as w,R as K,Y as g}from"./index-NBAmjDPo.js";import{Q as k,a as D}from"./QToolbar-CdQr3U-3.js";import{Q as o}from"./QItemLabel-Bs93CYCt.js";import{Q as I,a as p,b as m}from"./QList-Dp5SD6bt.js";import{Q as S}from"./QTooltip-B6ZEMbHi.js";import{Q as P}from"./QMarkupTable-ByLNg887.js";import{Q as U}from"./QPage-vWYdfFDK.js";import{c as N}from"./utility-BvzlK3Wi.js";import{P as V}from"./PageHeader-Bnmx8R_2.js";import{C as F}from"./ConfirmationModal-Dz1SD7zn.js";import"./QMenu-ikSdQUIb.js";import"./dayjs.min-CaSXwhts.js";import"./ClosePopup-BPFWk25n.js";const B=L({name:"CertificatesPage",components:{PageHeader:V},data(){return{loading:!1,uploadId:"",certificateDetails:{},sslDetails:{caChainFilename:null,certificate:null,certificateFilename:null,setupOn:0,sslSetup:!1},uploadedItems:[{fileType:this.$t("certificates.privateKey"),tooltip:this.$t("certificates.privateKeyTooltip"),id:"privateKey",time:null,name:null,uploaded:!1},{fileType:this.$t("certificates.caChain"),tooltip:this.$t("certificates.caChainTooltip"),id:"caChain",time:null,name:null,uploaded:!1},{fileType:this.$t("certificates.certificate"),tooltip:this.$t("certificates.certificateTooltip"),id:"certificate",time:null,name:null,uploaded:!1}]}},async created(){this.loading=!0;try{const e=await this.$api.get("/system/ssl");this.setUploadState(e.data)}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}this.loading=!1},methods:{convertTimestamp:N,onClickDeleteCert(e){this.$q.dialog({component:F,componentProps:{message:this.$t("certificates.deleteCertMessage",{certificate:e.name}),title:this.$t("certificates.deleteCertTitle"),type:"error",okText:this.$t("shared.delete")}}).onOk(()=>{this.deleteCert(e.id)})},async deleteCert(e){this.loading=!0;try{await this.$api.delete(`/upload?fileId=${e}`);const i=$.find(this.uploadedItems,["id",e]),c=i.name;i.name=null,i.uploaded=!1,i.time=null,this.$q.notify({type:"positive",message:this.$t("certificates.deleteSuccess",{fileName:c})})}catch(i){this.$q.notify({type:"negative",message:i.response.data.message})}this.loading=!1},setUploadState(e){this.certificateDetails=e.certificate||{},this.certificateDetails.caChainFilename=e.caChainFilename,this.certificateDetails.certificateFilename=e.certificateFilename,this.certificateDetails.privateKeyFilename=e.privateKeyFilename,this.sslDetails.sslSetup=e.sslSetup,this.uploadedItems.forEach((i,c)=>{const f=$.find(e,["fileId",i.id]);f===void 0?(this.uploadedItems[c].name=null,this.uploadedItems[c].time=null,this.uploadedItems[c].uploaded=!1):(this.uploadedItems[c].name=f.filename,this.uploadedItems[c].time=f.timestamp,this.uploadedItems[c].uploaded=!0)})},clearUploadedState(){this.uploadedItems.forEach((e,i)=>{this.uploadedItems[i].name=null,this.uploadedItems[i].uploaded=!1,this.uploadedItems[i].time=null})},uploadClick(e){this.uploadId=e,this.$refs.fileUpload.click()},async uploadCert(e){this.loading=!0;const i=new FormData;i.append(this.uploadId,e.target.files[0]);try{const c=await this.$api.post("/upload",i,{headers:{"Content-Type":"multipart/form-data"}}),f=$.find(this.uploadedItems,["id",this.uploadId]);f.name=c.data[0].fileInfo.filename,f.time=c.data[0].fileInfo.timestamp,f.uploaded=!0,this.$q.notify({type:"positive",message:this.$t("certificates.uploadSuccess",{fileName:f.name})})}catch(c){this.$q.notify({type:"negative",message:c.response.data.message})}this.loading=!1,this.uploadId=""},async setupSSL(){this.loading=!0;try{const e=await this.$api.post("system/ssl?action=setup");this.sslDetails.sslSetup=e.data.sslSetup,this.certificateDetails=e.data.certificate,this.certificateDetails.caChainFilename=e.data.caChainFilename,this.certificateDetails.certificateFilename=e.data.certificateFilename,this.certificateDetails.privateKeyFilename=e.data.privateKeyFilename,this.clearUploadedState(),this.$q.notify({type:"positive",message:this.$t("certificates.sslSetup")})}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}this.loading=!1},onClickDeleteSSL(){this.$q.dialog({component:F,componentProps:{message:this.$t("certificates.deleteSSLMessage"),title:this.$t("certificates.deleteSSLTitle"),type:"error",okText:this.$t("shared.delete")}}).onOk(()=>{this.deleteSSL()})},async deleteSSL(){this.loading=!0;try{await this.$api.delete("/system/ssl"),this.certificateDetails={},this.clearUploadedState(),this.sslDetails.sslSetup=!1,this.$q.notify({type:"positive",message:this.$t("certificates.sslDeleted")})}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}this.loading=!1}}}),M={key:0,class:"row items-center"},E={key:0,class:"q-ml-sm text-positive self-center"},O={key:1,class:"q-ml-sm text-negative self-center"},j={key:0,class:"row"},H={class:"col-6 q-pr-md"},A={class:"col-6 q-pr-md"},R={class:"text-left"},Y={class:"text-left"},z={class:"text-left"},G={class:"text-left"},J={class:"text-left"},W={class:"text-left"},X={class:"text-left"},Z={class:"text-left"},x={class:"text-left"},ee={class:"q-mt-md row justify-end"};function te(e,i,c,f,ae,ie){const T=b("PageHeader");return r(),u(U,{class:"chariot-page-container"},{default:t(()=>[a(T,{title:"Certificates",icon:"https"},{append:t(()=>[e.loading?_("",!0):(r(),h("div",M,[e.sslDetails.sslSetup?(r(),h("span",E,[a(y,{name:"lock"}),s(" "+l(e.$t("certificates.sslIsSetup")),1)])):(r(),h("span",O,[a(y,{name:"lock_open"}),s(" "+l(e.$t("certificates.sslNotSetup")),1)]))]))]),_:1}),e.loading?_("",!0):(r(),u(C,{key:0,class:"chariot-page-container-body q-pa-md"},{default:t(()=>[e.sslDetails.sslSetup?(r(),h("div",j,[n("div",H,[a(C,null,{default:t(()=>[a(k,null,{default:t(()=>[a(D,null,{default:t(()=>[s(l(e.$t("certificates.sslDetails")),1)]),_:1})]),_:1}),a(v,{class:"q-pa-sm"},{default:t(()=>[a(I,{separator:""},{default:t(()=>[a(p,null,{default:t(()=>[a(m,null,{default:t(()=>[a(o,null,{default:t(()=>[s(l(e.$t("certificates.issuer")),1)]),_:1}),a(o,{caption:""},{default:t(()=>[s(l(e.certificateDetails.Issuer),1)]),_:1})]),_:1})]),_:1}),a(p,null,{default:t(()=>[a(m,null,{default:t(()=>[a(o,null,{default:t(()=>[s(l(e.$t("certificates.signatureAlgorithm")),1)]),_:1}),a(o,{caption:""},{default:t(()=>[s(l(e.certificateDetails["Signature Algorithm"]),1)]),_:1})]),_:1})]),_:1}),a(p,null,{default:t(()=>[a(m,null,{default:t(()=>[a(o,null,{default:t(()=>[s(l(e.$t("certificates.subject")),1)]),_:1}),a(o,{caption:""},{default:t(()=>[s(l(e.certificateDetails.Subject),1)]),_:1})]),_:1})]),_:1}),a(p,null,{default:t(()=>[a(m,null,{default:t(()=>[a(o,null,{default:t(()=>[s(l(e.$t("certificates.validFrom")),1)]),_:1}),a(o,{caption:""},{default:t(()=>[s(l(e.convertTimestamp(e.certificateDetails["Valid From"])),1)]),_:1})]),_:1})]),_:1}),a(p,null,{default:t(()=>[a(m,null,{default:t(()=>[a(o,null,{default:t(()=>[s(l(e.$t("certificates.validTo")),1)]),_:1}),a(o,{caption:""},{default:t(()=>[s(l(e.convertTimestamp(e.certificateDetails["Valid To"])),1)]),_:1})]),_:1})]),_:1}),a(p,null,{default:t(()=>[a(m,null,{default:t(()=>[a(o,null,{default:t(()=>[s(l(e.$t("certificates.version")),1)]),_:1}),a(o,{caption:""},{default:t(()=>[s(l(e.certificateDetails.Version),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),n("div",A,[a(C,null,{default:t(()=>[a(k,null,{default:t(()=>[a(D,null,{default:t(()=>[s(l(e.$t("certificates.sslFiles")),1)]),_:1})]),_:1}),a(v,{class:"q-pa-sm"},{default:t(()=>[a(I,{separator:""},{default:t(()=>[a(p,null,{default:t(()=>[a(m,null,{default:t(()=>[a(o,null,{default:t(()=>[s(l(e.$t("certificates.privateKey")),1)]),_:1}),a(o,{caption:""},{default:t(()=>[s(l(e.certificateDetails.privateKeyFilename),1)]),_:1})]),_:1})]),_:1}),a(p,null,{default:t(()=>[a(m,null,{default:t(()=>[a(o,null,{default:t(()=>[s(l(e.$t("certificates.caChain")),1)]),_:1}),a(o,{caption:""},{default:t(()=>[s(l(e.certificateDetails.caChainFilename),1)]),_:1})]),_:1})]),_:1}),a(p,null,{default:t(()=>[a(m,null,{default:t(()=>[a(o,null,{default:t(()=>[s(l(e.$t("certificates.certificate")),1)]),_:1}),a(o,{caption:""},{default:t(()=>[s(l(e.certificateDetails.certificateFilename),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])])):(r(),u(P,{key:1},{default:t(()=>[n("thead",null,[n("tr",null,[n("th",R,l(e.$t("shared.status")),1),n("th",Y,l(e.$t("certificates.fileType")),1),n("th",z,l(e.$t("shared.name")),1),n("th",G,l(e.$t("shared.time")),1),i[4]||(i[4]=n("th",{class:"text-left"},null,-1))])]),n("tbody",null,[(r(!0),h(w,null,K(e.uploadedItems,d=>(r(),h("tr",{key:d.fileType},[n("td",J,[d.uploaded?(r(),u(y,{key:0,name:"check",class:"text-positive"})):(r(),u(y,{key:1,name:"close",class:"text-negative"}))]),n("td",W,[s(l(d.fileType)+" ",1),a(y,{color:"light",name:"help"},{default:t(()=>[a(S,null,{default:t(()=>[s(l(d.tooltip),1)]),_:2},1024)]),_:2},1024)]),n("td",X,l(d.name),1),n("td",Z,l(d.time?e.convertTimestamp(d.time):""),1),n("td",x,[d.uploaded?(r(),u(g,{key:0,flat:"",rounded:"",dense:"",color:"negative",icon:"delete",onClick:q=>e.onClickDeleteCert(d)},{default:t(()=>[a(S,null,{default:t(()=>[...i[5]||(i[5]=[s("Delete Certificate",-1)])]),_:1})]),_:1},8,["onClick"])):(r(),u(g,{key:1,flat:"",rounded:"",dense:"",icon:"upload",color:"primary-light",onClick:q=>e.uploadClick(d.id)},{default:t(()=>[a(S,null,{default:t(()=>[...i[6]||(i[6]=[s("Upload Certificate",-1)])]),_:1})]),_:1},8,["onClick"]))])]))),128))])]),_:1})),n("input",{type:"file",ref:"fileUpload",onClick:i[0]||(i[0]=d=>{d.target.value=null}),onChange:i[1]||(i[1]=(...d)=>e.uploadCert&&e.uploadCert(...d)),style:{display:"none"}},null,544),n("div",ee,[e.sslDetails.sslSetup?(r(),u(g,{key:0,label:"Delete Certificates",onClick:i[2]||(i[2]=d=>e.onClickDeleteSSL()),color:"negative",loading:e.loading},null,8,["loading"])):(r(),u(g,{key:1,label:"Setup SSL",onClick:i[3]||(i[3]=d=>e.setupSSL()),color:"primary",loading:e.loading},null,8,["loading"]))])]),_:1}))]),_:1})}const ge=Q(B,[["render",te]]);export{ge as default};

import{Q as D,a as P,b as C}from"./QList-Dp5SD6bt.js";import{Q as V}from"./QMenu-ikSdQUIb.js";import{k as H,c as N,h as B,L as I,_ as Q,d as v,Q as d,N as n,f as o,O as a,q as S,F as u,R as y,Y as q,U as p,V as m,b7 as U,M as c,S as w,$ as R,ax as Y,aq as T,P as L,au as M,at as j}from"./index-NBAmjDPo.js";import{Q as x,a as A,b as F,c as G}from"./QTabPanels-Cp3Ya--g.js";import{Q as O}from"./QPage-vWYdfFDK.js";import{C as E}from"./ClosePopup-BPFWk25n.js";import{P as z}from"./PageHeader-Bnmx8R_2.js";import{a as _,b as k,Q as J}from"./QTable-BxDh1Klk.js";import"./QResizeObserver-D41I_oPa.js";import"./QSelect-DFMwG8q_.js";import"./QItemLabel-Bs93CYCt.js";import"./QMarkupTable-ByLNg887.js";const $=H({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:r}){const i=N(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>B("tr",{style:e.props?.__trStyle,class:i.value},I(r.default))}}),K=v({name:"ThreadsTab",components:{},data(){return{loading:!1,pagination:{rowsPerPage:0},rows:[],columns:[{name:"threadId",field:"threadId",label:this.$t("diagnostics.threadId"),sortable:!1,align:"left"},{name:"threadName",field:"threadName",label:this.$t("diagnostics.threadName"),sortable:!1,align:"left"},{name:"threadState",field:"threadState",label:this.$t("diagnostics.threadState"),sortable:!1,align:"left"},{name:"daemon",field:"daemon",label:this.$t("diagnostics.daemon"),sortable:!1,align:"center"}]}},created(){this.updateGrid()},methods:{async updateGrid(){this.loading=!0;try{const e=await this.$api.get("/system/threads");this.rows=e.data.threads}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}this.loading=!1}}}),W={key:0,class:"chariot-diagnotics-stack-trace"},X={key:1};function Z(e,r,i,h,f,g){return n(),d("div",null,[o(J,{onRequest:e.updateGrid,loading:e.loading,rows:e.rows,columns:e.columns,pagination:e.pagination,"onUpdate:pagination":r[0]||(r[0]=t=>e.pagination=t),"rows-per-page-options":[0],"row-key":"threadId"},{header:a(t=>[o($,{props:t},{default:a(()=>[(n(!0),d(u,null,y(t.cols,s=>(n(),c(k,{key:s.name,props:t},{default:a(()=>[p(m(s.label),1)]),_:2},1032,["props"]))),128)),o(k,null,{default:a(()=>[...r[1]||(r[1]=[p(" Stack Trace ",-1)])]),_:1})]),_:2},1032,["props"])]),body:a(t=>[o($,{props:t},{default:a(()=>[(n(!0),d(u,null,y(t.cols,s=>(n(),c(_,{key:s.name,props:t},{default:a(()=>[s.name==="daemon"?(n(),d(u,{key:0},[s.value===!0?(n(),c(w,{key:0,color:"positive",name:"check"})):(n(),c(w,{key:1,name:"close",color:"negative"}))],64)):(n(),d(u,{key:1},[p(m(s.value),1)],64))]),_:2},1032,["props"]))),128)),o(_,{"auto-width":""},{default:a(()=>[o(q,{color:"primary",onClick:s=>t.expand=!t.expand},{default:a(()=>[p(m(t.expand?"Hide":"Show")+" "+m(t.row.stackTrace.length),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props"]),S(o($,{props:t},{default:a(()=>[o(_,{"no-hover":"",class:"chariot-diagnotics-stack-trace-holder",colspan:"100%"},{default:a(()=>[t.row.stackTrace.length!==0?(n(),d("ul",W,[(n(!0),d(u,null,y(t.row.stackTrace,(s,l)=>(n(),d("li",{key:l},m(s),1))),128))])):(n(),d("div",X," No traces "))]),_:2},1024)]),_:2},1032,["props"]),[[U,t.expand]])]),_:1},8,["onRequest","loading","rows","columns","pagination"])])}const ee=Q(K,[["render",Z]]),ae=v({name:"DiagnosticsPage",components:{PageHeader:z,ThreadsTab:ee},data(){let e="threads";return this.$route?.query?.tab?e=this.$route?.query?.tab:this.$router.replace({name:"diagnostics",query:{tab:e}}),{tab:"threads"}},methods:{async downloadThreadDump(){const e={...this.$baseHeader};e.responseType="blob",e.headers.Authorization=`bearer ${this.authToken}`;const r=this.$axios.create(e),i=new Date,h=String(i.getDate()).padStart(2,"0"),f=String(i.getMonth()+1).padStart(2,"0"),g=i.getFullYear(),t=`${f}_${h}_${g}`;try{const s=await r.post("/system/threads?action=export"),l=window.URL.createObjectURL(new Blob([s.data])),b=document.createElement("a");b.href=l,b.setAttribute("download",`chariot_threads_${t}.json`),b.click()}catch(s){this.$q.notify({type:"negative",message:s.response.data.message})}}},computed:{...R(Y,["authToken"])},watch:{tab(){this.$router.push({name:"diagnostics",query:{...this.$route.query,tab:this.tab}})},$route:{handler(){this.$route.query.tab&&(this.tab=this.$route.query.tab)}}}});function te(e,r,i,h,f,g){const t=T("PageHeader"),s=T("ThreadsTab");return n(),c(O,{class:"chariot-page-container"},{default:a(()=>[o(t,{title:"Diagnostics",icon:"content_paste_search"},{append:a(()=>[o(q,{icon:"more_vert",flat:"",dense:"",rounded:""},{default:a(()=>[o(V,null,{default:a(()=>[o(D,{style:{"min-width":"100px"}},{default:a(()=>[S((n(),c(P,{clickable:""},{default:a(()=>[o(C,{onClick:e.downloadThreadDump},{default:a(()=>[...r[2]||(r[2]=[L("div",{class:"row items-center"}," Download Thread Dump ",-1)])]),_:1},8,["onClick"])]),_:1})),[[E]])]),_:1})]),_:1})]),_:1})]),_:1}),o(M,{class:"chariot-page-container-body"},{default:a(()=>[o(x,{modelValue:e.tab,"onUpdate:modelValue":r[0]||(r[0]=l=>e.tab=l),dense:"","active-color":"primary-light",align:"justify"},{default:a(()=>[o(A,{name:"threads",label:"Threads"})]),_:1},8,["modelValue"]),o(j),o(F,{modelValue:e.tab,"onUpdate:modelValue":r[1]||(r[1]=l=>e.tab=l)},{default:a(()=>[o(G,{name:"threads"},{default:a(()=>[o(s)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const fe=Q(ae,[["render",te]]);export{fe as default};

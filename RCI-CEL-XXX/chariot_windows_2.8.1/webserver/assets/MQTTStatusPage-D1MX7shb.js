import{Q as G,a as R,b as O,c as _}from"./QTabPanels-Cp3Ya--g.js";import{_ as S,d as k,Q as z,N as f,P as r,f as t,O as l,Y as U,q as M,ar as F,M as m,X as A,aE as W,U as i,V as a,aF as $,S as p,au as b,aN as N,aO as B,$ as H,ax as j,aq as w,at as X}from"./index-NBAmjDPo.js";import{Q as Y}from"./QPage-vWYdfFDK.js";import{P as J}from"./PageHeader-Bnmx8R_2.js";import{a as v,Q}from"./QTable-BxDh1Klk.js";import{Q as q,b as u,a as d}from"./QList-Dp5SD6bt.js";import{Q as K}from"./QMenu-ikSdQUIb.js";import{Q as y,a as V}from"./QToolbar-CdQr3U-3.js";import{Q as s}from"./QItemLabel-Bs93CYCt.js";import{Q as T}from"./QTooltip-B6ZEMbHi.js";import{C as D}from"./ClosePopup-BPFWk25n.js";import{r as Z,c as L}from"./utility-BvzlK3Wi.js";import{C as x}from"./ConfirmationModal-Dz1SD7zn.js";import"./QResizeObserver-D41I_oPa.js";import"./QSelect-DFMwG8q_.js";import"./QMarkupTable-ByLNg887.js";import"./dayjs.min-CaSXwhts.js";const ee=k({name:"MQTTClientsTab",data(){return{filterText:this.$route.query.clientId?this.$route.query.clientId:"",livePoll:null,clientSelectedRow:[],loading:!1,isLive:!0,rows:[],subscriptions:[],pagination:{rowsPerPage:B("mqttclients")},columns:[{name:"clientId",label:"Client ID",field:"clientId",sortable:!1,align:"left"},{name:"ipAddress",align:"left",label:"IP Address",field:"ipAddress",sortable:!1},{name:"state",align:"left",label:"Connected",field:"state",sortable:!1},{name:"actions",label:"",field:"actions",sortable:!1}],subscriptionColumns:[{name:"qos",label:"QOS",field:"qos",align:"left",sortable:!1},{name:"topic",label:"Topic",field:"topic",align:"left",sortable:!1}]}},created(){this.updateGrid()},unmounted(){this.stopPoll()},methods:{convertTimestamp:L,readableBoolean:Z,async updateGrid(){this.loading=!0;try{const e=await this.$api.get("/server/clients");this.loading=!1,this.rows=e.data.clients,this.$route.query.clientId&&(this.clientSelectedRow=this.rows.filter(n=>n.clientId===this.$route.query.clientId),this.$router.replace({name:"mqttstatus",query:{tab:"clients"}})),this.updateRowCheck(e.data.clients,this.clientSelectedRow),this.isLive&&this.$router.currentRoute.value.name==="mqttstatus"&&this.startPoll()}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}this.loading=!1},updateRowCheck(e,n){if(n.length>0){let c=!1,g=null;e.forEach(h=>{h.clientId===n[0].clientId&&(g=h,c=!0)}),c?this.clientSelectedRow=[g]:this.clientSelectedRow=[]}},async onClickDisconnectClient(e){this.loading=!0;try{await this.$api.post(`/server?action=disconnect&clientId=${e.clientId}`),this.$q.notify({type:"positive",message:this.$t("mqttClients.disconnected",{clientId:e.clientId})}),this.clientValue!==null&&this.clientValue.clientId===e.clientId&&(this.clientSelectedRow=[]),this.updateGrid()}catch(n){n.response.status===403?this.$q.notify({type:"negative",message:this.$t("mqttClients.disconnectionAccessError")}):this.$q.notify({type:"negative",message:n.response.data.message})}},async onClickDeleteClient(e){this.loading=!0;try{await this.$api.post(`/server?action=remove&clientId=${e.clientId}`),this.$q.notify({type:"positive",message:this.$t("mqttClients.deleted",{clientId:e.clientId})}),this.clientValue!==null&&this.clientValue.clientId===e.clientId&&(this.clientSelectedRow=[]),this.updateGrid()}catch(n){this.$q.notify({type:"negative",message:n.response.data.message})}this.loading=!1},stopPoll(){clearTimeout(this.livePoll)},startPoll(){this.livePoll=setTimeout(()=>{this.updateGrid()},3e3)}},computed:{clientValue(){return this.clientSelectedRow.length>0?this.clientSelectedRow[0]:null}},watch:{isLive(){this.isLive?this.startPoll():this.stopPoll()},"pagination.rowsPerPage":{handler(){N("mqttclients",this.pagination.rowsPerPage)}}}}),te={class:"mqtt-clients-table-holder"},le={class:"row q-mt-md"},ae={class:"col-4 q-pr-md"},ie={class:"col-4 q-pr-md"},ne={class:"col-4"},se={class:"row"},oe={class:"col"};function ue(e,n,c,g,h,P){return f(),z("div",null,[r("div",te,[t(Q,{selected:e.clientSelectedRow,"onUpdate:selected":n[2]||(n[2]=o=>e.clientSelectedRow=o),pagination:e.pagination,"onUpdate:pagination":n[3]||(n[3]=o=>e.pagination=o),filter:e.filterText,"table-class":"mqtt-clients-table",loading:e.loading,rows:e.rows,columns:e.columns,selection:"single","row-key":"clientId","rows-per-page-options":[5,10,20,50,100]},{top:l(()=>[t(A,{class:"chariot-client-status-table-filter q-mr-md",modelValue:e.filterText,"onUpdate:modelValue":n[0]||(n[0]=o=>e.filterText=o),dense:"",outlined:"",label:"Filter"},null,8,["modelValue"]),t(W,{modelValue:e.isLive,"onUpdate:modelValue":n[1]||(n[1]=o=>e.isLive=o),label:"Is Live"},null,8,["modelValue"])]),"body-cell-state":l(o=>[t(v,{props:o},{default:l(()=>[o.row.state==="CONNECTED"?(f(),m(p,{key:0,class:"text-positive",name:"check_circle",size:"18px"})):(f(),m(p,{key:1,class:"text-negative",name:"cancel",size:"18px"}))]),_:2},1032,["props"])]),"body-cell-actions":l(o=>[t(v,{props:o},{default:l(()=>[t(U,{color:"primary-light",icon:"more_vert",flat:"",dense:"",rounded:""},{default:l(()=>[t(K,null,{default:l(()=>[t(q,{style:{"min-width":"100px"}},{default:l(()=>[o.row.state==="CONNECTED"?M((f(),m(d,{key:0,clickable:""},{default:l(()=>[t(u,{onClick:()=>e.onClickDisconnectClient(o.row)},{default:l(()=>[...n[4]||(n[4]=[r("div",{class:"row items-center"}," Disconnect ",-1)])]),_:1},8,["onClick"])]),_:2},1024)),[[D]]):F("",!0),M((f(),m(d,{clickable:""},{default:l(()=>[t(u,{onClick:I=>e.onClickDeleteClient(o.row)},{default:l(()=>[...n[5]||(n[5]=[r("div",{class:"row items-center"}," Delete ",-1)])]),_:1},8,["onClick"])]),_:2},1024)),[[D]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["selected","pagination","filter","loading","rows","columns"])]),r("div",le,[r("div",ae,[t(b,null,{default:l(()=>[t(y,null,{default:l(()=>[t(V,null,{default:l(()=>[i(a(e.$t("mqttClients.network")),1)]),_:1})]),_:1}),t($,null,{default:l(()=>[t(q,{separator:""},{default:l(()=>[t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.ipAddress")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.ipAddress:"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.state")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.state:"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.lastActive")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.convertTimestamp(e.clientValue.lastActive):"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.connectionSince")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.convertTimestamp(e.clientValue.connectedOn):"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.bytesRx")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.bytesRx:"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.bytesTx")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.bytesTx:"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.inboundQueueSize"))+" ",1),t(p,{color:"light",name:"help"},{default:l(()=>[t(T,null,{default:l(()=>[i(a(e.$t("mqttClients.tooltips.inboundQueueSize")),1)]),_:1})]),_:1})]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.inboundQueueSize:"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.outboundQueueSize"))+" ",1),t(p,{color:"light",name:"help"},{default:l(()=>[t(T,null,{default:l(()=>[i(a(e.$t("mqttClients.tooltips.outboundQueueSize")),1)]),_:1})]),_:1})]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.outboundQueueSize:"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.packetWriteQueueSize"))+" ",1),t(p,{color:"light",name:"help"},{default:l(()=>[t(T,null,{default:l(()=>[i(a(e.$t("mqttClients.tooltips.packetWriteQueueSize")),1)]),_:1})]),_:1})]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.packetWriteQueueSize:"-"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),r("div",ie,[t(b,null,{default:l(()=>[t(y,null,{default:l(()=>[t(V,null,{default:l(()=>[i(a(e.$t("mqttClients.session")),1)]),_:1})]),_:1}),t($,null,{default:l(()=>[t(q,{separator:""},{default:l(()=>[t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.clientId")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.clientId:"-"),1)]),_:1})]),_:1})]),_:1}),e.clientValue&&e.clientValue.username?(f(),m(d,{key:0,to:`/mqttaccounts?tab=credentials&username=${e.clientValue.username}`},{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("shared.username")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue&&e.clientValue.username!==null?e.clientValue.username:"-"),1)]),_:1})]),_:1}),t(u,{avatar:""},{default:l(()=>[t(p,{color:"light",name:"link"})]),_:1})]),_:1},8,["to"])):(f(),m(d,{key:1},{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("shared.username")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[...n[6]||(n[6]=[i("-",-1)])]),_:1})]),_:1})]),_:1})),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.cleanSession")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.readableBoolean(e.clientValue.cleanSession):"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.keepAlive")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.keepalive:"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.connectionType")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.clientValue.type:"-"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),r("div",ne,[t(b,null,{default:l(()=>[t(y,null,{default:l(()=>[t(V,null,{default:l(()=>[i(a(e.$t("mqttClients.lastWill")),1)]),_:1})]),_:1}),t($,null,{default:l(()=>[t(q,{separator:""},{default:l(()=>[t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.willTopic")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue&&e.clientValue.willTopic?e.clientValue.willTopic:"-"),1)]),_:1})]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.willQos")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue&&e.clientValue.willQoS!==null?e.clientValue.willQoS:"-"),1)]),_:1})]),_:1})]),_:1}),e.clientValue&&e.clientValue.willTopic&&e.clientValue.willRetained?(f(),m(d,{key:0,to:`/mqttstatus?tab=retained&message=${e.clientValue.willTopic}`},{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.willRetained")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.readableBoolean(e.clientValue.willRetained):"-"),1)]),_:1})]),_:1}),t(u,{avatar:""},{default:l(()=>[t(p,{color:"light",name:"link"})]),_:1})]),_:1},8,["to"])):(f(),m(d,{key:1},{default:l(()=>[t(u,null,{default:l(()=>[t(s,null,{default:l(()=>[i(a(e.$t("mqttClients.willRetained")),1)]),_:1}),t(s,{caption:""},{default:l(()=>[i(a(e.clientValue?e.readableBoolean(e.clientValue.willRetained):"-"),1)]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})])]),r("div",se,[r("div",oe,[t(b,{class:"q-mt-md"},{default:l(()=>[t(y,null,{default:l(()=>[t(V,null,{default:l(()=>[i(a(e.$t("mqttClients.subscriptions")),1)]),_:1})]),_:1}),t($,null,{default:l(()=>[t(Q,{flat:"",loading:e.loading,rows:e.clientValue?e.clientValue.subscriptions:[],columns:e.subscriptionColumns,"row-key":"qos"},null,8,["loading","rows","columns"])]),_:1})]),_:1})])])])}const de=S(ee,[["render",ue]]),re=k({name:"MQTTRetainedMessagesTab",data(){return{pagination:{rowsPerPage:B("mqttretained")},loading:!1,filterText:this.$route.query.message?this.$route.query.message:"",retainedSelected:[],rows:[],columns:[{name:"topic",label:"Topic",field:"topic",align:"left",sortable:!1},{name:"qos",label:"QOS",field:"qos",align:"left",sortable:!1},{name:"size",label:"Size",field:"size",align:"left",sortable:!1},{name:"timestamp",label:"Timestamp",field:"timestamp",align:"left",sortable:!1},{name:"clear",label:"",align:"left",sortable:!1}]}},created(){this.updateGrid()},methods:{convertTimestamp:L,async updateGrid(){this.loading=!0;try{const e=await this.$api.get("/server/retained");this.loading=!1,this.rows=e.data,this.$route.query.message&&this.$router.replace({name:"mqttstatus",query:{tab:"retained"}})}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}this.loading=!1},onClickDeleteRetainedMessage(){this.$q.dialog({component:x,componentProps:{message:"Are you sure you want to delete these retained messages?",title:"Delete Retained Message",type:"error",okText:this.$t("shared.delete")}}).onOk(()=>{this.deleteRetainedMessages()})},async deleteRetainedMessages(){try{await this.$api.post("/server/retained?action=clear",{topics:this.retainedSelected.map(e=>e.topic)}),this.updateGrid(),this.$q.notify({type:"positive",message:"Retained messages successfully deleted"})}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}}},watch:{"pagination.rowsPerPage":{handler(){N("mqttretained",this.pagination.rowsPerPage)}}}}),fe={class:"chariot-retained-message-table-header"};function me(e,n,c,g,h,P){return f(),z("div",null,[t(Q,{pagination:e.pagination,"onUpdate:pagination":n[2]||(n[2]=o=>e.pagination=o),selected:e.retainedSelected,"onUpdate:selected":n[3]||(n[3]=o=>e.retainedSelected=o),"row-key":"topic",selection:"multiple",loading:e.loading,filter:e.filterText,rows:e.rows,columns:e.columns},{top:l(()=>[r("div",fe,[t(A,{class:"chariot-retained-message-table-filter q-mr-md",modelValue:e.filterText,"onUpdate:modelValue":n[0]||(n[0]=o=>e.filterText=o),dense:"",outlined:"",label:"Filter"},null,8,["modelValue"]),t(U,{disable:e.retainedSelected.length===0,onClick:n[1]||(n[1]=o=>e.onClickDeleteRetainedMessage()),color:"negative",label:"Delete"},null,8,["disable"])])]),"body-cell-timestamp":l(o=>[t(v,{props:o},{default:l(()=>[i(a(e.convertTimestamp(o.row.timestamp)),1)]),_:2},1032,["props"])]),_:1},8,["pagination","selected","loading","filter","rows","columns"])])}const pe=S(re,[["render",me]]),ce=k({name:"MQTTStatusPage",components:{ClientsTab:de,PageHeader:J,RetainedMessages:pe},computed:{...H(j,["helpUrl"])},data(){let e="clients";return this.$route?.query?.tab?e=this.$route?.query?.tab:this.$router.replace({name:"mqttstatus",query:{tab:e}}),{tab:e}},watch:{tab(){this.$router.push({name:"mqttstatus",query:{...this.$route.query,tab:this.tab}})},$route:{handler(){this.$route.query.tab&&(this.tab=this.$route.query.tab)}}}}),ge=["href"];function he(e,n,c,g,h,P){const o=w("PageHeader"),I=w("ClientsTab"),E=w("RetainedMessages");return f(),m(Y,{class:"chariot-page-container"},{default:l(()=>[t(o,{title:e.$t("mqttClients.statusTitle"),help:!0,icon:"badge"},{popover:l(()=>[r("p",null,a(e.$t("mqttClients.help")),1),r("a",{target:"_blank",href:`${e.helpUrl}/Chariot+MQTT+Server+Usage#ChariotMQTTServerUsage-MQTT`},a(e.$t("shared.moreDetails"))+"...",9,ge)]),_:1},8,["title"]),t(b,{class:"chariot-page-container-body"},{default:l(()=>[t(G,{modelValue:e.tab,"onUpdate:modelValue":n[0]||(n[0]=C=>e.tab=C),dense:"","active-color":"primary-light",align:"justify"},{default:l(()=>[t(R,{name:"clients",label:e.$t("mqttClients.clients")},null,8,["label"]),t(R,{name:"retained",label:e.$t("mqttClients.retainedMessages")},null,8,["label"])]),_:1},8,["modelValue"]),t(X),t(O,{modelValue:e.tab,"onUpdate:modelValue":n[1]||(n[1]=C=>e.tab=C)},{default:l(()=>[t(_,{name:"clients"},{default:l(()=>[t(I)]),_:1}),t(_,{name:"retained"},{default:l(()=>[t(E)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const De=S(ce,[["render",he]]);export{De as default};

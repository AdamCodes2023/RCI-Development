import{_ as L,d as V,M as k,N as d,O as t,$ as q,ax as T,aq as S,f as s,P as l,U as u,V as i,Q as c,au as h,S as p,as as o,b6 as A,at as w,aE as y,F as b,q as f,aF as v,W as m,X as I,Z as E,b7 as O,Y as N}from"./index-NBAmjDPo.js";import{Q as $}from"./QForm-2fLQLKgE.js";import{Q}from"./QInnerLoading-DLOuihN2.js";import{Q as P}from"./QPage-vWYdfFDK.js";import{c as G}from"./copy-to-clipboard-Deab3tYM.js";import{d as M}from"./dayjs.min-CaSXwhts.js";import{P as R}from"./PageHeader-Bnmx8R_2.js";import{B as z}from"./BasicModal-C1PQ0FKo.js";import"./QMenu-ikSdQUIb.js";import"./QToolbar-CdQr3U-3.js";import"./ClosePopup-BPFWk25n.js";const B=V({name:"LicensePage",components:{BasicModal:z,PageHeader:R},data(){return{showGenerateCodeModal:!1,showUploadLicenseModal:!1,showUploadActivationModal:!1,disableLiveCards:!1,online:!0,dragOver:!1,activationText:"",loading:!1,licenseText:"",licenseUploaded:!1,licenseActivationDate:null,licenseActivationPeriod:0,licenseExpiration:null,licenseId:"N/A",offlineCode:"",autoActivate:!0,copyCodeBlockShow:!1}},async created(){this.loading=!0;try{const e=await this.$api.get("/license");this.setLicenseState(e.data)}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}this.loading=!1},methods:{setLicenseState(e){const a=T();this.licenseActivationDate=e.activatedOn?M(e.activatedOn).format("MMMM D, YYYY h:mm A"):"N/A",this.licenseActivationPeriod=e.activationPeriod,this.licenseExpiration=e.expiresOn?M(e.expiresOn).format("MMMM D, YYYY h:mm A"):"N/A",this.licenseId=e.licenseId||"N/A",this.online=e.onlineActivation===null?this.online:e.onlineActivation,e.licenseId!==null&&(this.licenseUploaded=!0),a.$patch({licenseState:e.state,licenseMode:e.mode})},fileDropped(e){const{files:a}=e.dataTransfer;this.readFile(a)},readFile(e){if(e.length===1){const a=e[0];if(a.type.indexOf("text/")>=0){const r=new FileReader;r.onload=g=>{this.licenseText=g.target.result,this.onClickUploadLicenseModal()},r.readAsText(a)}else this.licenseText="",this.$q.notify({type:"negative",message:this.$t("license.invalidFileFormat")})}},async addLicense(){this.loading=!0;try{const e=await this.$api.post("/license",{text:this.licenseText});this.setLicenseState(e.data),this.autoActivate&&this.licenseAction("activate")}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}this.loading=!1},async licenseAction(e,a=void 0){this.loading=!0;try{const r=await this.$api.post(`/license?action=${e}`,a);this.setLicenseState(r.data)}catch(r){this.$q.notify({type:"negative",message:r.response.data.message})}this.loading=!1},onClickUploadLicenseModal(){this.showUploadLicenseModal=!0},onCloseUploadLicenseModal(){this.showUploadLicenseModal=!1},onClickActivationModal(){this.showUploadActivationModal=!0},onSaveActivation(){this.licenseAction("manual-activate",{text:this.activationText}),this.onCloseActivationModal()},onCloseActivationModal(){this.activationText="",this.showUploadActivationModal=!1},async onClickGenerateCodeModal(){let e="get-manual-activation-request";this.licenseState==="ACTIVE"&&(e="get-manual-deactivation-request");const a=await this.$api.post(`/license?action=${e}`);if(this.offlineCode=a.data.requestText,e==="get-manual-deactivation-request"){this.loading=!0;const r=await this.$api.get("/license");this.setLicenseState(r.data),this.loading=!1}this.showGenerateCodeModal=!0},onCloseGenerateCodeModal(){this.showGenerateCodeModal=!1},saveGeneratedCodeToClipboard(){G(this.offlineCode).then(()=>{this.$q.notify({type:"positive",message:"Successfully copied to clipboard"})}).catch(()=>{this.$q.notify({type:"negative",message:"Failed to copy to clipboard"})})},onSaveLicense(){this.addLicense(),this.onCloseUploadLicenseModal()}},computed:{...q(T,["licenseState","licenseMode","helpUrl"]),iconType(){let e="";switch(this.licenseState){case"ACTIVE":e="check";break;case"INACTIVE":this.licenseUploaded?e="warning":e="highlight_off";break;default:e="warning"}return e},classType(){let e="";switch(this.licenseState){case"ACTIVE":e="text-positive";break;case"INACTIVE":this.licenseUploaded?e="text-warning":e="text-negative";break;default:e="text-warning"}return e},generateUploadClass(){let e="chariot-upload-box text-center";return this.dragOver&&(e+=" drag-over"),e}}}),D=["href"],F=["href"],Y={class:"chariot-page-container-body"},H={class:"row"},K={class:"col-12 q-mb-md"},j={class:"chariot-license-details q-pa-md"},W={class:"q-pr-md"},X={class:"q-pr-md"},Z={class:"q-pr-md"},J={class:"q-pr-md"},x={class:"q-pr-md"},_={class:"q-my-none"},ee={key:1,class:"chariot-warning-box text-center"},ae={class:"q-my-none"},le={class:"col-4"},se={class:"col-4"},ie={class:"col-4"},te={class:"col-4"},ne={class:"col-4"},oe={style:{"max-height":"300px"}};function de(e,a,r,g,re,ce){const U=S("PageHeader"),C=S("BasicModal");return d(),k(P,{class:"chariot-page-container"},{default:t(()=>[s(U,{title:"License",icon:"timer",help:!0},{popover:t(()=>[l("p",null,[u(i(e.$t("license.help"))+" ",1),l("a",{target:"_blank",href:`${e.helpUrl}/Chariot+MQTT+Server+Configuration#ChariotMQTTServerConfiguration-LicenseConfiguration`},i(e.$t("shared.moreDetails"))+"...",9,D)]),l("p",null,[u(i(e.$t("license.procedure"))+" ",1),l("a",{target:"_blank",href:`${e.helpUrl}/Licensing+Procedure`},i(e.$t("shared.moreDetails"))+"...",9,F)])]),_:1}),l("div",Y,[l("div",H,[l("div",K,[s(h,null,{default:t(()=>[l("div",null,[l("div",j,[s(p,{class:o(e.classType),size:"100px",name:e.iconType},null,8,["class","name"]),l("ul",null,[l("li",null,[l("b",W,i(e.$t("license.status"))+":",1),u(" "+i(e.licenseState),1)]),l("li",null,[l("b",X,i(e.$t("license.licenseId"))+":",1),u(" "+i(e.licenseId),1)]),l("li",null,[l("b",Z,i(e.$t("license.activationDate"))+":",1),u(" "+i(e.licenseActivationDate),1)]),l("li",null,[l("b",J,i(e.$t("license.activationPeriod"))+":",1),u(" "+i(e.licenseActivationPeriod),1)]),l("li",null,[l("b",x,i(e.$t("license.expiration"))+":",1),u(" "+i(e.licenseExpiration),1)])]),e.licenseMode==="NORMAL"?(d(),c("div",{key:0,onClick:a[0]||(a[0]=(...n)=>e.onClickUploadLicenseModal&&e.onClickUploadLicenseModal(...n)),class:o(e.generateUploadClass),onDrop:a[1]||(a[1]=A(n=>e.fileDropped(n),["prevent"])),onDragout:a[2]||(a[2]=A(n=>{e.dragOver=!1},["prevent"])),onDragover:a[3]||(a[3]=A(n=>{e.dragOver=!0},["prevent"]))},[s(p,{class:"text-primary",size:"75px",name:"upload"}),l("h5",_,i(e.$t("license.uploadLicense")),1)],34)):(d(),c("div",ee,[s(p,{class:"text-primary",size:"75px",name:"cloud_off"}),l("h5",ae,i(e.$t("license.noUploadLicense")),1)]))]),s(w),s(y,{label:"Online Activation",modelValue:e.online,"onUpdate:modelValue":a[4]||(a[4]=n=>e.online=n)},null,8,["modelValue"])])]),_:1})]),e.online?(d(),c(b,{key:0},[l("div",le,[s(h,{onClick:a[5]||(a[5]=n=>e.licenseState==="ACTIVE"||e.licenseUploaded===!1?null:e.licenseAction("activate")),class:o(["chariot-clickable-card","q-mr-md"])},{default:t(()=>[f((d(),c("div",{class:o([{disabled:e.licenseState==="ACTIVE"||e.licenseUploaded===!1,"q-hoverable":!(e.licenseState==="ACTIVE"||e.licenseUploaded===!1)}])},[a[13]||(a[13]=l("span",{class:"q-focus-helper"},null,-1)),s(v,null,{default:t(()=>[s(p,{class:"text-primary",size:"75px",name:"sensors"}),l("h5",null,i(e.$t("license.activateLicense")),1)]),_:1})],2)),[[m,!(e.licenseState==="ACTIVE"||e.licenseUploaded===!1)]])]),_:1})]),l("div",se,[s(h,{onClick:a[6]||(a[6]=n=>e.licenseState==="INACTIVE"||e.licenseState==="TRIAL"?null:e.licenseAction("deactivate")),class:o(["chariot-clickable-card","q-mr-md"])},{default:t(()=>[f((d(),c("div",{class:o([{disabled:e.licenseState==="INACTIVE"||e.licenseState==="TRIAL","q-hoverable":!(e.licenseState==="INACTIVE"||e.licenseState==="TRIAL")}])},[a[14]||(a[14]=l("span",{class:"q-focus-helper"},null,-1)),s(v,null,{default:t(()=>[s(p,{class:"text-primary",size:"75px",name:"sensors_off"}),l("h5",null,i(e.$t("license.deactivateLicense")),1)]),_:1})],2)),[[m,!(e.licenseState==="INACTIVE"||e.licenseState==="TRIAL")]])]),_:1})])],64)):(d(),c(b,{key:1},[l("div",ie,[s(h,{onClick:a[7]||(a[7]=n=>e.licenseState==="ACTIVE"||e.licenseUploaded===!1?null:e.onClickGenerateCodeModal()),class:o(["chariot-clickable-card","q-mr-md"])},{default:t(()=>[f((d(),c("div",{class:o([{disabled:e.licenseState==="ACTIVE"||e.licenseUploaded===!1,"q-hoverable":!(e.licenseState==="ACTIVE"||e.licenseUploaded===!1)}])},[a[15]||(a[15]=l("span",{class:"q-focus-helper"},null,-1)),s(v,null,{default:t(()=>[s(p,{class:"text-primary",size:"75px",name:"code"}),l("h5",null,i(e.$t("license.generateActivate")),1)]),_:1})],2)),[[m,!(e.licenseState==="ACTIVE"||e.licenseUploaded===!1)]])]),_:1})]),l("div",te,[s(h,{onClick:a[8]||(a[8]=n=>e.licenseState==="ACTIVE"||e.licenseUploaded===!1?null:e.onClickActivationModal()),class:o(["chariot-clickable-card","q-mr-md"])},{default:t(()=>[f((d(),c("div",{class:o([{disabled:e.licenseState==="ACTIVE"||e.licenseUploaded===!1,"q-hoverable":!(e.licenseState==="ACTIVE"||e.licenseUploaded===!1)}])},[a[16]||(a[16]=l("span",{class:"q-focus-helper"},null,-1)),s(v,null,{default:t(()=>[s(p,{class:"text-primary",size:"75px",name:"upload"}),l("h5",null,i(e.$t("license.uploadActivation")),1)]),_:1})],2)),[[m,!(e.licenseState==="ACTIVE"||e.licenseUploaded===!1)]])]),_:1})]),l("div",ne,[s(h,{onClick:a[9]||(a[9]=n=>e.licenseState==="INACTIVE"||e.licenseState==="TRIAL"?null:e.onClickGenerateCodeModal()),class:o(["chariot-clickable-card"])},{default:t(()=>[f((d(),c("div",{class:o([{disabled:e.licenseState==="INACTIVE"||e.licenseState==="TRIAL","q-hoverable":!(e.licenseState==="INACTIVE"||e.licenseState==="TRIAL")}])},[a[17]||(a[17]=l("span",{class:"q-focus-helper"},null,-1)),s(v,null,{default:t(()=>[s(p,{class:"text-primary",size:"75px",name:"do_disturb"}),l("h5",null,i(e.$t("license.deactivateAndGenerate")),1)]),_:1})],2)),[[m,!(e.licenseState==="INACTIVE"||e.licenseState==="TRIAL")]])]),_:1})])],64))])]),s(C,{"show-footer":!1,open:e.showUploadLicenseModal,title:e.$t("license.uploadKey"),onOnClose:e.onCloseUploadLicenseModal},{"chariot-modal-footer":t(()=>[s(E,{class:"chariot-modal-footer",align:e.online?"between":"right"},{default:t(()=>[f(s(y,{label:"Activate",modelValue:e.autoActivate,"onUpdate:modelValue":a[11]||(a[11]=n=>e.autoActivate=n)},null,8,["modelValue"]),[[O,e.online]]),s(N,{disable:e.licenseText.length===0,onClick:e.onSaveLicense,label:e.$t("shared.save"),color:"primary"},null,8,["disable","onClick","label"])]),_:1},8,["align"])]),default:t(()=>[s($,{class:"q-pb-none column"},{default:t(()=>[l("div",null,[s(I,{label:e.$t("license.enterKey"),modelValue:e.licenseText,"onUpdate:modelValue":a[10]||(a[10]=n=>e.licenseText=n),outlined:"",type:"textarea"},null,8,["label","modelValue"])])]),_:1})]),_:1},8,["open","title","onOnClose"]),s(C,{"show-footer":!0,open:e.showUploadActivationModal,title:e.$t("license.uploadCode"),onOnClose:e.onCloseActivationModal,onOnSave:e.onSaveActivation},{default:t(()=>[s($,{class:"q-gutter-y-md column"},{default:t(()=>[l("div",null,[s(I,{label:e.$t("license.enterKey"),modelValue:e.activationText,"onUpdate:modelValue":a[12]||(a[12]=n=>e.activationText=n),outlined:"",type:"textarea"},null,8,["label","modelValue"])])]),_:1})]),_:1},8,["open","title","onOnClose","onOnSave"]),s(C,{open:e.showGenerateCodeModal,title:e.$t("license.offlineActivate"),"save-text":"Copy",onOnSave:e.saveGeneratedCodeToClipboard,onOnClose:e.onCloseGenerateCodeModal},{default:t(()=>[l("div",null,[l("pre",oe,i(e.offlineCode),1)])]),_:1},8,["open","title","onOnSave","onOnClose"]),s(Q,{showing:e.loading,color:"primary",label:"Loading...","label-style":"font-size: 1.1em"},null,8,["showing"])]),_:1})}const ye=L(B,[["render",de]]);export{ye as default};

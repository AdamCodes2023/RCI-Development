import{Q as k,a as w,b as Q,c as v}from"./QTabPanels-Cp3Ya--g.js";import{_ as f,d as y,Q as P,N as b,f as t,O as i,aE as n,P as $,U as g,V as h,X as q,aN as A,aO as U,M as C,aq as c,au as L,at as G}from"./index-NBAmjDPo.js";import{Q as S}from"./QPage-vWYdfFDK.js";import{P as B}from"./PageHeader-Bnmx8R_2.js";import{Q as V}from"./QSelect-DFMwG8q_.js";import{a as r,Q as T}from"./QTable-BxDh1Klk.js";import{Q as N}from"./QTooltip-B6ZEMbHi.js";import{c as R}from"./utility-BvzlK3Wi.js";import"./QResizeObserver-D41I_oPa.js";import"./QMenu-ikSdQUIb.js";import"./QList-Dp5SD6bt.js";import"./QItemLabel-Bs93CYCt.js";import"./QMarkupTable-ByLNg887.js";import"./dayjs.min-CaSXwhts.js";const D=y({name:"LiveAlertsTab",data(){return{loading:!1,livePoll:null,isLive:!0,pagination:{sortBy:"desc",descending:!1,page:1,rowsPerPage:U("alerts"),rowsNumber:0},rows:[],descriptionFilter:"",typeFilter:{value:null,label:this.$t("alerts.allAlerts")},clearedFilter:!1,ackowledgedFilter:!1,columns:[{name:"activeTime",field:"activeTime",align:"left",sortable:!1,class:"timestamp-cell",label:this.$t("alerts.activeTime")},{name:"priority",field:"priority",align:"left",sortable:!1,label:this.$t("alerts.priority")},{name:"description",field:"description",align:"left",sortable:!1,label:this.$t("alerts.description")},{name:"type",field:"type",align:"left",sortable:!1,label:this.$t("alerts.type")},{name:"cleared",field:"cleared",align:"left",sortable:!1,label:this.$t("alerts.cleared")},{name:"acknowledged",field:"acknowledged",align:"left",sortable:!1,label:"ACKED"}],alertTypeOptions:[{value:null,label:this.$t("alerts.allAlerts")}]}},async created(){(await this.$api.get("/alertinfo")).data.types.forEach(l=>{this.alertTypeOptions.push({value:l,label:l})}),this.updateGrid({pagination:this.pagination})},unmounted(){this.stopPoll()},methods:{convertTimestamp:R,async updateGrid(e){this.stopPoll();const{page:l,rowsPerPage:d,sortBy:p,descending:u}=e.pagination;this.pagination.page=l,this.pagination.rowsPerPage=d,this.pagination.sortBy=p,this.pagination.descending=u,this.loading=!0,this.stopPoll();let o=`/alerts?limit=${this.pagination.rowsPerPage}&offset=${this.pagination.rowsPerPage*(this.pagination.page-1)}`;this.descriptionFilter.length>0&&(o+=`&descriptionFilter=${encodeURIComponent(this.descriptionFilter)}`),this.typeFilter.value!==null&&(o+=`&type=${this.typeFilter.value}`),this.clearedFilter&&(o+="&cleared=false"),this.ackowledgedFilter&&(o+="&acknowledged=false");try{const a=await this.$api.get(o);this.isLive&&this.$router.currentRoute.value.name==="alerts"&&this.startPoll(),this.rows=a.data.results,this.pagination.rowsNumber=a.data.info.total}catch(a){this.$q.notify({type:"negative",message:a.response.data.message})}this.loading=!1},stopPoll(){clearTimeout(this.livePoll)},startPoll(){this.livePoll=setTimeout(()=>{this.updateGrid({pagination:this.pagination})},3e3)},async saveAlertState(e){this.stopPoll(),this.loading=!0;try{await this.$api.put(`/alerts/${e.id}`,e),this.$q.notify({type:"positive",message:this.$t("alerts.updateSuccess")})}catch(l){this.$q.notify({type:"negative",message:l.response.data.message})}this.isLive&&this.startPoll(),this.loading=!1}},watch:{descriptionFilter(){this.pagination.page=1,this.updateGrid({pagination:this.pagination})},typeFilter(){this.pagination.page=1,this.updateGrid({pagination:this.pagination})},clearedFilter(){this.pagination.page=1,this.updateGrid({pagination:this.pagination})},ackowledgedFilter(){this.pagination.page=1,this.updateGrid({pagination:this.pagination})},isLive(){this.isLive?this.startPoll():this.stopPoll()},"pagination.rowsPerPage":{handler(){A("alerts",this.pagination.rowsPerPage)}}}}),E={class:"chariot-alert-live-table-header"},H={style:{"max-width":"400px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}};function O(e,l,d,p,u,o){return b(),P("div",null,[t(T,{pagination:e.pagination,"onUpdate:pagination":l[5]||(l[5]=a=>e.pagination=a),onRequest:e.updateGrid,loading:e.loading,rows:e.rows,columns:e.columns,"rows-per-page-options":[5,10,20,50,100]},{top:i(()=>[$("div",E,[t(q,{debounce:"500",class:"chariot-alert-live-table-header-filter-text",modelValue:e.descriptionFilter,"onUpdate:modelValue":l[0]||(l[0]=a=>e.descriptionFilter=a),dense:"",outlined:"",label:"Description Search"},null,8,["modelValue"]),t(V,{class:"q-mx-lg chariot-alert-live-table-header-types-select",dense:"",outlined:"",modelValue:e.typeFilter,"onUpdate:modelValue":l[1]||(l[1]=a=>e.typeFilter=a),options:e.alertTypeOptions,label:"Filter By Alert Type"},null,8,["modelValue","options"]),t(n,{modelValue:e.clearedFilter,"onUpdate:modelValue":l[2]||(l[2]=a=>e.clearedFilter=a),label:"Hide Cleared"},null,8,["modelValue"]),t(n,{modelValue:e.ackowledgedFilter,"onUpdate:modelValue":l[3]||(l[3]=a=>e.ackowledgedFilter=a),label:"Hide Acknowledged"},null,8,["modelValue"]),t(n,{modelValue:e.isLive,"onUpdate:modelValue":l[4]||(l[4]=a=>e.isLive=a),label:"Live"},null,8,["modelValue"])])]),"body-cell-activeTime":i(a=>[t(r,{props:a},{default:i(()=>[g(h(e.convertTimestamp(a.row.activeTime)),1)]),_:2},1032,["props"])]),"body-cell-description":i(a=>[t(r,{props:a},{default:i(()=>[$("div",H,[g(h(a.row.description)+" ",1),t(N,null,{default:i(()=>[g(h(a.row.description),1)]),_:2},1024)])]),_:2},1032,["props"])]),"body-cell-cleared":i(a=>[t(r,{props:a},{default:i(()=>[t(n,{onClick:s=>e.saveAlertState(a.row),modelValue:a.row.cleared,"onUpdate:modelValue":s=>a.row.cleared=s},null,8,["onClick","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acknowledged":i(a=>[t(r,{props:a},{default:i(()=>[t(n,{onClick:s=>e.saveAlertState(a.row),modelValue:a.row.acknowledged,"onUpdate:modelValue":s=>a.row.acknowledged=s},null,8,["onClick","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),_:1},8,["pagination","onRequest","loading","rows","columns"])])}const j=f(D,[["render",O]]),I=y({name:"TypesTab",components:{},data(){return{loading:!1,rows:[],columns:[{name:"enabled",label:"Enabled",field:"enabled",align:"left",sortable:!1},{name:"name",label:"Name",field:"name",align:"left",sortable:!1},{name:"path",label:"Path",field:"path",align:"left",sortable:!1},{name:"priority",label:"Priority",field:"priority",align:"left",sortable:!1}]}},async created(){this.updateGrid()},methods:{async updateGrid(){this.loading=!0;try{const e=await this.$api.get("/alerttypes");this.rows=e.data.results}catch(e){this.$q.notify({type:"negative",message:e.response.data.message})}this.loading=!1},async saveAlertType(e){this.loading=!0;try{await this.$api.put(`/alerttypes/${e.name}`,e),this.$q.notify({type:"positive",message:"Successfully updated alert type"})}catch(l){this.$q.notify({type:"negative",message:l.response.data.message})}this.loading=!1}}});function K(e,l,d,p,u,o){return b(),P("div",null,[t(T,{loading:e.loading,rows:e.rows,columns:e.columns,"row-key":"name","rows-per-page-options":[0]},{"body-cell-enabled":i(a=>[t(r,{props:a},{default:i(()=>[t(n,{onClick:s=>e.saveAlertType(a.row),modelValue:a.row.enabled,"onUpdate:modelValue":s=>a.row.enabled=s},null,8,["onClick","modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-priority":i(a=>[t(r,{props:a},{default:i(()=>[t(V,{dense:"",outlined:"","onUpdate:modelValue":[s=>{e.saveAlertType({...a.row,priority:s})},s=>a.row.priority=s],modelValue:a.row.priority,options:[1,2,3]},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1032,["props"])]),_:1},8,["loading","rows","columns"])])}const M=f(I,[["render",K]]),X=y({name:"AlertsPage",components:{PageHeader:B,LiveAlerts:j,TypesTab:M},data(){let e="live";return this.$route?.query?.tab?e=this.$route?.query?.tab:this.$router.replace({name:"alerts",query:{tab:e}}),{tab:e}},watch:{tab(){this.$router.push({name:"alerts",query:{...this.$route.query,tab:this.tab}})},$route:{handler(){this.$route.query.tab&&(this.tab=this.$route.query.tab)}}}});function z(e,l,d,p,u,o){const a=c("PageHeader"),s=c("LiveAlerts"),F=c("TypesTab");return b(),C(S,{class:"chariot-page-container"},{default:i(()=>[t(a,{title:e.$t("alerts.title"),icon:"notifications"},null,8,["title"]),t(L,{class:"chariot-page-container-body"},{default:i(()=>[t(k,{modelValue:e.tab,"onUpdate:modelValue":l[0]||(l[0]=m=>e.tab=m),dense:"","active-color":"primary-light",align:"justify"},{default:i(()=>[t(w,{name:"live",label:e.$t("alerts.liveAlerts")},null,8,["label"]),t(w,{name:"types",label:e.$t("alerts.types")},null,8,["label"])]),_:1},8,["modelValue"]),t(G),t(Q,{modelValue:e.tab,"onUpdate:modelValue":l[1]||(l[1]=m=>e.tab=m)},{default:i(()=>[t(v,{name:"live"},{default:i(()=>[t(s)]),_:1}),t(v,{name:"types"},{default:i(()=>[t(F)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const re=f(X,[["render",z]]);export{re as default};
